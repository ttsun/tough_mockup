
{% extends "base.html" %}

{% block head %}
<script type="text/javascript" src="/static/js/alertify.min.js"></script>
<link rel="stylesheet" type="text/css" href="/static/css/alertify.css"/>
<link rel="stylesheet" type="text/css" href="/static/css/alertify.bootstrap.css"/>
<style type="text/css"> 

textarea{
    width:auto;
}
#dirinput, #batch_form{
    padding:2em;
}

</style>

<script type="text/javascript" src="/static/js/blocks.js"></script>
<script type="text/javascript" src="/static/js/setup.js"></script>
<script type="text/javascript">

var jobfiles;
var current_doc;
var job_id;

function getjobfiles(){
    $('#fileloader').show();
    console.log(job_id)
    $.ajax({
        type: 'GET',

        url: TOUGH_SUBDIR+'/get_tough_files/' + job_id,

        success: function(data){
            jobfiles = data;
            console.log(data);
            console.log(jobfiles);
            $('#fileloader').hide();
        },
        error: function(err){
            // alert("There was a problem getting the input files.");
            $('#fileloader').hide();
        }
    });
}

function setupBlocks(blockName){
    var block = $("#reqblocks").append("<li></li>");
    $("#reqblocks").children("li").last().attr("id", blockName);
    $("#reqblocks").children("li").last().attr("class", "blockchoice");
    $("#reqblocks").children("li").last().html("<a href=\"#\"" + blockName + ">" + blockName + "</a>");
}

function showRawInput(blockName){

}

$(document).ready(function(){

   $(".diroptions").click(function(e){
       e.preventDefault();
       $("#jobdir").val($(this).attr("data-dir"));
   });
   $("#batch").click(function(e){
        guify_batch();
   });
   $('#savecompset').click(function(e){
        console.log("saved comp set")
        save_batch();
   });
   $("#submitdir").click(function(ev){
        ev.preventDefault();
        // document.forms['dirinput'].submit();
        $.ajax({
            url: $("#dirinput").attr("action"),
            data: $("#dirinput").serialize(),
            type: "POST",
            success: function(data){
                Alertify.log.success(data['job_name']+" created at "+data['job_dir']);
                $("#reqblocks li").removeClass("disabled");
                $("#opblocks li").removeClass("disabled");
                $("#compsetselect").parent().removeClass("disabled").addClass("active");
                $("a[href=#dirsetup]").parent().removeClass("active").addClass("disabled");
                showBlock("#compset");
                current_doc = "batch";
            }
        });
        var values = {};
        $.each($('#dirinput').serializeArray(), function(i, field) {
            values[field.name] = field.value;
        });
        Alertify.log.info("Creating job directory for \"" + values["jobname"] + "\" in \"" + values["jobdir"] + "\"");
        job_id = values['job_id'];
   });
   $("#sidebar a").click(function(e){
        if($(this).parent("li[class~=disabled]").length == 0){
            e.preventDefault();
            showBlock($(this).attr("href"));
            current_doc = $(this).parent().attr("id");
        }
        return false;
    });
   $(".block:not(.blockactive)").hide();
   $(".blockchoice").addClass("disabled");
   $("#batch").parent().addClass("disabled");
   getjobfiles();
});


function showBlock(id){
    $(".blockactive").removeClass("blockactive").hide();
    $("#sidebar .active").removeClass("active");
    if ($("#sidebar [href="+id+"]").parent("li").attr("class") != "disabled"){
        $("#sidebar [href="+id+"]").parent("li").addClass("active");
    }
    $(id).addClass("blockactive").show();
    $(".block:not(.blockactive)").hide();
}
</script>
{% endblock head %}

{%block content %}
<div class = "row-fluid">
    <div class = "span2 well" id = "sidebar">
        <ul class = "nav nav-list">
            <li class = "nav-header">Required Information</li>
            <li><a href="#dirsetup">Directory Setup</a></li>
            <li><a href="#compset" id = "batch">Computational Settings</a></li>
        </ul>
        <ul id = "reqblocks" class = "nav nav-list">
            <li class = "nav-header">Required Blocks</li>
            <li class = "blockchoice"><a href="#block1">Block 1</a></li>
            <li class = "blockchoice"><a href="#block2">Block 2</a></li> 
            <li class = "blockchoice"><a href="#">Block 3</a></li> 
            <li class = "blockchoice"><a href="#">Block 4</a></li>
            <li class = "blockchoice"><a href="#">Block 5</a></li>
        </ul>
        <ul id = "opblocks" class="nav nav-list">
            <li class = "nav-header"> Optional Blocks</li>
            <li class = "blockchoice"><a href="#">Block 1</a></li>
            <li class = "blockchoice"><a href="#">Block 2</a></li> 
            <li class = "blockchoice"><a href="#">Block 3</a></li> 
            <li class = "blockchoice"><a href="#">Block 4</a></li>
            <li class = "blockchoice"><a href="#">Block 5</a></li>
        </ul>
    </div>
    <div class = "span10 blockactive" id = "dirsetup">
        <h2>Directory Setup</h2>
         <form action="{% url 'tough.views.setup_new' %}" method = "POST" id="dirinput">
            {% csrf_token %}
            <input type = "hidden" name ="setup_type" id = "setup_type" value = "new" />
            <div>
            <label for="jobname">What do you want to name this job?</label>
            <input type="text" name="jobname" id="jobname" size="50"/>
            </div>
            <div>
                <label for="machine">Which machine should this job run on?</label>
                <select name="machine" id="machine">
                    <option value="hopper" selected="selected">hopper</option>
                    <option value="carver">carver</option>
                </select>
            </div>
            <div class="input-append">
                <label for"jobdir">Where would you like to store this job?</label>
                <input type="text" name="jobdir" id="jobdir" size="50" value="/global/">
                <div class="btn-group">
                    <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" id="dirSelect">
                        <li><a class='diroptions' href="#" data-dir="/global/homes/t/tsun">Home Directory</a></li>
                        <li><a class='diroptions' href="#" data-dir="/global/scratch/sd/tsun">Scratch Directory</a><li>
                    </ul>
                </div>
            </div>
            <div>
                <button class="btn btn-primary" type="button" id='submitdir'>Submit</button>
            </div>
        </form>
    </div>
    <div class = "span10 block" id = "compset">
        <h2>Computational Settings</h2>
        {% include "batch_form.html" %}
    </div>
    <div class = "span10 block" id = "block1">
        <ul class = "nav nav-tabs">
            <li class = "active"><a href="#guided" data-toggle = "tab">Guided</a></li>
            <li><a href="#raw" data-toggle = "tab">Raw Text</a></li>
        </ul>
        <div class = "tab-content" style =" height:500px">
            <div class = "tab-pane active" id = "guided" style = "height:500px">
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas nisi ligula, varius sit amet convallis eget, ullamcorper vitae lorem. Ut ultricies erat turpis, quis eleifend ante ultrices id. Donec ut est venenatis, viverra enim nec, placerat quam. Duis hendrerit fringilla dolor id fringilla. Nulla facilisi. Proin aliquet nisi ultricies, luctus lacus in, sodales felis. Aenean quis ullamcorper est, ac gravida nunc. Phasellus nunc diam, vehicula quis tortor et, facilisis pellentesque dui. Praesent eleifend lorem nec odio pulvinar commodo. Integer at condimentum justo, ac placerat libero.
                </p>
            </div>
            <div class = "tab-pane" id = "raw">

                <p><textarea name="thetext" rows="30" id="thetext" cols="120"></textarea></p>
                <button class="btn" type="button" id='saveform'>Save</button>
                <button class="btn" type="button" id='cancel'>Cancel</button>
            </div>
        </div>
    </div>
</div>
{% endblock content %}    