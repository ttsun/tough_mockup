{% extends "base.html"%}
{% load file_filters %}
{% block head %}
	<script type="text/javascript">
		$(document).ready(function(){
			getFolder("");			
		});

		function getFolder(dir){
			$("#file_list").html("");
			$.get("{% url 'tough.views.ajax_get_job_dir' job_id=job.pk %}" + dir, function(response){
				if(response.success){
					for(var x in response.listing){
						var file = response.listing[x];
						$("#file_list").append("<tr class='entry'></tr>");
						var curr_entry = $($(".entry").last());
						if(file.is_folder){
							if(file.name==".."){
								curr_entry.append("<td><a class='folder' href='/job/{{job.pk}}/file/"+dir+file.name+"/' data-dir='"+dir+file.name+"/'><i class='icon-folder-close'></i>"+file.name+"</a></td>");
							}else{								
								curr_entry.append("<td><a class='folder' href='/job/{{job.pk}}/file/"+dir+file.name+"/' data-dir='"+dir+file.name+"/'><i class='icon-folder-close'></i>"+file.name+"</a> <a href='/job/{{job.pk}}/zip/"+dir+file.name+"'><i class='icon-download-alt'></i>ZIP</a></td>");
							}
						}else{
							curr_entry.append("<td><a class='file' href='/job/{{job.pk}}/file/"+dir+file.name+"/'><i class='icon-file'></i>"+file.name+"</a></td>");
						}
						curr_entry.append("<td>"+file.size+"</td>");
						curr_entry.append("<td>"+file.date+"</td>");
					}
					$(".folder").click(function(e){
						e.preventDefault();
						getFolder($(this).attr("data-dir"));
						return false;
					});
				}
			});
		}
	</script>
{% endblock head %}
{% block content %}
<div class = "row-fluid">
	<div class = "span2 well">
		<ul class = "nav nav-list">
			<li class="nav-header">Options</li>
		   	<li><a href = "{% url 'tough.views.create_job' 'copy' job.pk%}" id = "copyjob" class = "popup">Copy Job</a></li>
			<li><a href = "{% url 'tough.views.delete_job' job.pk %}" id = "deljob">Delete Job</a></li>
			<li><a href = "{%url 'tough.views.ajax_get_zip' job_id=job.pk %}">Download {{job.jobname}} as ZIP</a></li>
		</ul>
	</div>
	<div class = "span10">
		<h1>{{jobname}}</h1>
		<h2>Job Information</h2>
		<div class="row-fluid">
			<div class="span6">			
				<p><strong>System:</strong> Hopper</p>
				<p><strong>Job Directory:</strong> {{jobdir}}</p>
				<p><strong>Number of Processors:</strong> {{job.numprocs}}</p>		
				<p><strong>Job Status:</strong> {{job.state | capfirst}}</p>
			</div>
			<div class="span6">				
				{% if job.time_submitted %}
					<p><strong>Time Submitted:</strong> {{job.time_submitted}}</p>
				{% endif %}
				{% if job.time_started %}
					<p><strong>Time Started:</strong> {{job.time_started}}</p>
				{% endif %}
				{% if job.time_completed %}
					<p><strong>Time Completed:</strong> {{job.time_completed}}</p>
				{% endif %}
				{% if job.project %}
					<p><strong>Project:</strong> {{job.project.name}}</p>
				{% endif %}
				{% if job.timeuse %}
					<p><strong>Time Elapsed:</strong> {{job.timeuse}}</p>
				{% endif %}
			</div>
		</div>
		<div class="row-fluid">
			<h2>Files</h2>				
			<table class = "table table-hover table-striped">
				<thead>
					<tr>
						<th>File Name</th>
						<th>Size</th>
						<th>Last Modified</th>
					</tr>
				</thead>
				<tbody id="file_list">
				</tbody>
			</table>
		</div>
	</div>
</div>
{% endblock %}
