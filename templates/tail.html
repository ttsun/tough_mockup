<html>
<head>
	<title>Tail File</title>
	<link href="/static/css/bootstrap.min.css" rel="stylesheet" media="screen">
	<script src="/static/js/jquery.js"></script>
	<script src="/static/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/css/main.css">	
	<link rel="stylesheet" type="text/css" href="/static/css/jquery-ui-1.10.3.custom.min.css">
    <script type="text/javascript" src="/static/js/jquery-ui-1.10.3.custom.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/css/alertify.css"/>
	<link rel="stylesheet" type="text/css" href="/static/css/alertify.bootstrap.css"/>
	<script type = "text/javascript">
		var currentLine;

		function tail(){
			$.get($("#tail").attr("href"), {'curr':currentLine}, function(data){
				if(data.success){
					$("#currentcontent").append(data['new_content']);
					currentLine = data['current_line'];
					console.log("currentLine:" + currentLine);
					console.log("new data: " + data['new_content']);
				}
			});
		}

		$(document).ready(function(){
			currentLine = $("#current_line").val();
			console.log("starting line: " + currentLine);
			$("#tail").click(function(e){
				e.preventDefault();
				// if ($(this).text == "Tail File"){
					tail();
					setInterval(function(){
						tail();
					}, 15000);
					$(this).removeClass("btn-primary");
					$(this).addClass("btn-warning");
					$(this).text = "Stop Tailing";
				// } else {

				// }
			});
		})

	</script>
</head>
<body>
	<div class="navbar">
		<div class="navbar-inner row-fluid">
			<a id="tail" class="btn btn-primary span2 offset9" href="/job/status/{{job_id}}/tail/{{filepath}}/">Tail File</a>
		</div>
		<input type = "hidden" id = "current_line" value = "{{current_line}}" />
	</div>
	<h1>File</h1>
	<p>Maybe this should use bootstrap</p>
	<div id = "content">
		<pre id= "currentcontent">{{file_content}}</pre>
	</div>
</body>
</html>